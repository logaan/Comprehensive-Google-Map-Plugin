var jQueryCgmp=jQuery.noConflict();
(function(a){"undefined"!=typeof CGMPGlobal&&!CGMPGlobal.maps instanceof Array&&(CGMPGlobal.maps=[]);var i=function(){var a={};return{initMap:function(b,c,i,h){a=b;"ROADMAP"==h?h=google.maps.MapTypeId.ROADMAP:"SATELLITE"==h?h=google.maps.MapTypeId.SATELLITE:"HYBRID"==h?h=google.maps.MapTypeId.HYBRID:"TERRAIN"==h&&(h=google.maps.MapTypeId.TERRAIN);a.setOptions({zoom:i,mapTypeId:h,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}})},mapControl:function(b,j){switch(j){case i.ControlType.SCROLLWHEEL:a.setOptions({scrollwheel:"false"==
b?!1:!0});break;case i.ControlType.MAPTYPE:a.setOptions({mapTypeControl:"false"==b?!1:!0});break;case i.ControlType.PAN:a.setOptions({panControl:"false"==b?!1:!0});break;case i.ControlType.ZOOM:a.setOptions({zoomControl:"false"==b?!1:!0});break;case i.ControlType.SCALE:a.setOptions({scaleControl:"false"==b?!1:!0});break;case i.ControlType.STREETVIEW:a.setOptions({streetViewControl:"false"==b?!1:!0});break;default:c.warn("Unknown map control type: "+j)}},ControlType:{PAN:0,ZOOM:1,SCALE:2,STREETVIEW:3,
MAPTYPE:4,SCROLLWHEEL:5}}}(),p=function(){var a={};return{init:function(b){a=b},buildKmlLayer:function(b){if(0>b.toLowerCase().indexOf("http"))return c.error("KML URL must start with HTTP(S). Aborting.."),!1;var j=new google.maps.KmlLayer(b);google.maps.event.addListener(j,"status_changed",function(){var a=j.getStatus();if(a!=google.maps.KmlLayerStatus.OK){var b="";switch(a){case google.maps.KmlLayerStatus.DOCUMENT_NOT_FOUND:b=CGMPGlobal.errors.kmlNotFound;break;case google.maps.KmlLayerStatus.DOCUMENT_TOO_LARGE:b=
CGMPGlobal.errors.kmlTooLarge;break;case google.maps.KmlLayerStatus.FETCH_ERROR:b=CGMPGlobal.errors.kmlFetchError;break;case google.maps.KmlLayerStatus.INVALID_DOCUMENT:b=CGMPGlobal.errors.kmlDocInvalid;break;case google.maps.KmlLayerStatus.INVALID_REQUEST:b=CGMPGlobal.errors.kmlRequestInvalid;break;case google.maps.KmlLayerStatus.LIMITS_EXCEEDED:b=CGMPGlobal.errors.kmlLimits;break;case google.maps.KmlLayerStatus.TIMED_OUT:b=CGMPGlobal.errors.kmlTimedOut;break;case google.maps.KmlLayerStatus.UNKNOWN:b=
CGMPGlobal.errors.kmlUnknown}if(""!=b){var g=CGMPGlobal.errors.kml.replace("[MSG]",b),g=g.replace("[STATUS]",a);y.alertError(g);c.error("Google returned KML error: "+b+" ("+a+")");c.error("KML file: "+j.getUrl())}}});j.setMap(a)},buildTrafficLayer:function(){(new google.maps.TrafficLayer).setMap(a)},buildBikeLayer:function(){(new google.maps.BicyclingLayer).setMap(a)},buildPanoramioLayer:function(b){if("undefined"==typeof google.maps.panoramio||!google.maps.panoramio||null==google.maps.panoramio)return c.error("We cannot access Panoramio library. Aborting.."),
!1;var j=new google.maps.panoramio.PanoramioLayer;j?(null!=b&&""!=b&&j.setUserId(b),j.setMap(a)):c.error("Could not instantiate Panoramio object. Aborting..")}}}(),H=function(){function g(){null!=t?m.setCenter()!=t.getCenter()&&(c.info("Panning map back to its original bounds center: "+t.getCenter()+" and updated zoom: "+q),m.setCenter(t.getCenter()),m.setZoom(q)):null!=z&&(c.info("Panning map back to its original center: "+z+" and updated zoom: "+q),m.setCenter(z),m.setZoom(q))}function b(e){a(e+
" input#a_address").val("");a(e+" input#b_address").val("");a(e+" input#a_address").removeClass("d_error");a(e+" input#b_address").removeClass("d_error")}function j(e,k){var d=Q(e.content,k),f="div#direction-controls-placeholder-"+o,l=a("div#rendered-directions-placeholder-"+o);google.maps.event.addListener(e,"click",function(){b(f);a(f).fadeOut();u.setMap(null);l.html("");l.hide();a(f+" button#print_sub").hide();r.setContent(d.bubbleContent);r.setOptions({disableAutoPan:"true"==I?!1:!0});r.open(m,
this)});h(e,d,f);i(e,d,f,l)}function i(e,k,d,f){var l="div#bubble-"+k.bubbleHolderId,c=e.content,c=c.replace("Lat/Long: ","");a(l+" a.dirToHereTrigger").live("click",function(){this.id=="toHere-"+k.bubbleHolderId&&(a(d).fadeIn(),a(d+" input#a_address").val(""),a(d+" input#b_address").val(c),a(d+" input#radio_miles").attr("checked","checked"))});a(l+" a.dirFromHereTrigger").live("click",function(){this.id=="fromHere-"+k.bubbleHolderId&&(a(d).fadeIn(),a(d+" input#a_address").val(c),a(d+" input#b_address").val(""),
a(d+" input#radio_miles").attr("checked","checked"))});a(d+" div.d_close-wrapper").live("click",function(){b(d);a(this).parent().fadeOut();u.setMap(null);f.html("");f.hide();a(d+" button#print_sub").hide();g();return!1})}function h(e,k,d){J.getPanoramaByLocation(e.position,50,function(f,l){l===google.maps.StreetViewStatus.OK?a("a#trigger-"+k.bubbleHolderId).live("click",function(){var f={navigationControl:!0,enableCloseButton:!0,addressControl:!1,linksControl:!0,scrollwheel:!1,addressControlOptions:{position:google.maps.ControlPosition.BOTTOM},
position:e.position,pov:{heading:165,pitch:0,zoom:1}},c=new google.maps.StreetViewPanorama(document.getElementById("bubble-"+k.bubbleHolderId),f);c.setVisible(!0);google.maps.event.addListener(r,"closeclick",function(){b(d);a(d).fadeOut();null!=c&&(c.unbind("position"),c.setVisible(!1));c=null});google.maps.event.addListener(c,"closeclick",function(){null!=c&&(c.unbind("position"),c.setVisible(!1),a("div#bubble-"+k.bubbleHolderId).css("background","none"));c=null})}):(c.warn("There is not street view available for this marker location: "+
e.position+" status: "+l),a("a#trigger-"+k.bubbleHolderId).live("click",function(a){a.preventDefault()}),a("a#trigger-"+k.bubbleHolderId).attr("style","text-decoration: none !important; color: #ddd !important"),google.maps.event.addListener(r,"domready",function(){a("a#trigger-"+k.bubbleHolderId).removeAttr("href");a("a#trigger-"+k.bubbleHolderId).attr("style","text-decoration: none !important; color: #ddd !important")}))})}function p(){var e="div#direction-controls-placeholder-"+o,b=a("div#rendered-directions-placeholder-"+
o);a(e+" a#reverse-btn").live("click",function(){var b=a(e+" input#a_address").val(),f=a(e+" input#b_address").val();a(e+" input#a_address").val(f);a(e+" input#b_address").val(b);return!1});a(e+" a#d_options_show").live("click",function(){a(e+" a#d_options_hide").show();a(e+" a#d_options_show").hide();a(e+" div#d_options").show();return!1});a(e+" a#d_options_hide").live("click",function(){a(e+" a#d_options_hide").hide();a(e+" a#d_options_show").show();a(e+" div#d_options").hide();a(e+" input#avoid_hway").removeAttr("checked");
a(e+" input#avoid_tolls").removeAttr("checked");a(e+" input#radio_km").removeAttr("checked");a(e+" input#radio_miles").attr("checked","checked");return!1});a(e+" button#d_sub").live("click",function(){var d=a(e+" input#a_address").val(),f=a(e+" input#b_address").val(),l=!1;if(null==d||""==d)a(e+" input#a_address").addClass("d_error"),l=!0;if(null==f||""==f)a(e+" input#b_address").addClass("d_error"),l=!0;if(!l){a(e+" button#d_sub").attr("disabled","disabled").html("Please wait..");var g=google.maps.DirectionsTravelMode.DRIVING;
a(e+" a#dir_w_btn").hasClass("selected")&&(g=google.maps.DirectionsTravelMode.WALKING);var l=a(e+" input#avoid_hway").is(":checked"),j=a(e+" input#avoid_tolls").is(":checked"),i=a(e+" input#radio_miles").is(":checked"),g={origin:d,destination:f,travelMode:g,provideRouteAlternatives:!0};l&&(g.avoidHighways=!0);j&&(g.avoidTolls=!0);g.unitSystem=i?google.maps.DirectionsUnitSystem.IMPERIAL:google.maps.DirectionsUnitSystem.METRIC;K.route(g,function(g,l){l==google.maps.DirectionsStatus.OK?(b.html(""),b.show(),
u.setMap(m),u.setDirections(g),a(e+" button#d_sub").removeAttr("disabled").html("Get directions"),a(e+" button#print_sub").fadeIn(),r.close()):(c.error('Could not route directions from "'+d+'" to "'+f+'", got result from Google: '+l),b.html("<span style='font-size: 12px; font-weight: bold; color: red'>Could not route directions from<br />'"+d+"' to<br />'"+f+"'<br />Got result from Google: ["+l+"]</span>"),a(e+" button#print_sub").hide(),a(e+" button#d_sub").removeAttr("disabled").html("Get directions"))})}});
a(e+" button#print_sub").live("click",function(){var b=a(e+" input#a_address").val(),f=a(e+" input#b_address").val(),k="d";a(e+" a#dir_w_btn").hasClass("selected")&&(k="w");b="http://maps.google.com/?saddr="+b+"&daddr="+f+"&dirflg="+k+"&pw=2";a(e+" input#radio_miles").is(":checked")&&(b+="&doflg=ptm");window.open(b);return!1});a(e+" input#a_address").live("change focus",function(){a(e+" input#a_address").removeClass("d_error");return!1});a(e+" input#b_address").live("change focus",function(){a(e+
" input#b_address").removeClass("d_error");return!1});a(e+" .kd-button").live("click",function(){var b=this.id;"dir_d_btn"==b?a(e+" a#dir_d_btn").hasClass("selected")?c.warn("Driving travel mode is already selected"):(a(e+" a#dir_d_btn").addClass("selected"),a(e+" a#dir_w_btn").removeClass("selected")):"dir_w_btn"==b&&(a(e+" a#dir_w_btn").hasClass("selected")?c.warn("Walking travel mode is already selected"):(a(e+" a#dir_w_btn").addClass("selected"),a(e+" a#dir_d_btn").removeClass("selected")));return!1})}
function Q(a,b){var d=Math.floor(111111*Math.random()),d=d+"-"+o,f="<div id='bubble-"+d+"' style='height: 130px !important; width: 300px !important;' class='bubble-content'>";if(b.geoMashup)var c=b.postTitle.substring(0,30),f=f+""+("<p style='text-align: left'><a style='font-size: 15px !important; font-weight: bold !important;' title='Original post: "+b.postTitle+"' href='"+b.postLink+"'>"+c+"..</a></p>"),f=f+("<p style='font-size: 12px !important; padding-left: 12px !important; padding-right: 6px !important; text-align: left; line-height: 130% !important'>"+
b.postExcerpt+"</p>");else f=f+"<h4>Address:</h4>"+("<p style='text-align: left'>"+a+"</p>");return{bubbleHolderId:d,bubbleContent:f+"<hr />"+("<p style='text-align: left'>Directions: <a id='toHere-"+d+"' class='dirToHereTrigger' href='javascript:void(0);'>To here</a> - <a id='fromHere-"+d+"' class='dirFromHereTrigger' href='javascript:void(0);'>From here</a> | <a id='trigger-"+d+"' class='streetViewTrigger' href='javascript:void(0);'>Street View</a></p>")+"</div>"}}function L(e,b){var d=1;a.each(e,
function(){c.info("Looping over JSON object:\n\tTitle: "+this.title+"\n\tAddy: "+this.addy+"\n\tLink: "+this.permalink+"\n\tExcerpt: "+this.excerpt);var a=this.addy.split(CGMPGlobal.sep);n.isNumeric(a[0])?M(a[0],d,a[1],this.title,this.permalink,this.excerpt,b):n.isAlphaNumeric(a[0])?A(a[0],d,a[1],this.title,this.permalink,this.excerpt,b):(A(a[0],d,a[1],this.title,this.permalink,this.excerpt,b),c.warn("Unknown type of geo destination in regexp: "+a[0]+", fallingback to store it as an address"));d++})}
function A(a,b,d,f,g,j,i){c.info("Storing address: "+a+" for marker-to-be for the map ID: "+o);v.push({address:a,animation:google.maps.Animation.DROP,zIndex:b,markerIcon:d,postTitle:f,postLink:g,postExcerpt:j,geoMashup:i})}function M(a,b,d,f,g,j,i){if(null==a||!a)return c.warn("Given GEO point containing Lat/Long is NULL"),!1;var h=a;if(!(h instanceof google.maps.LatLng)&&-1!=a.indexOf(",")){h=a.split(",",4);if(null==h||2!=h.length)return c.warn("Exploded lat/long array is NULL or does not have length of two"),
!1;if(null==h[0]||null==h[1])return c.warn("Lat or Long are NULL"),!1;h[0]=n.trim(h[0]);h[1]=n.trim(h[1]);if(""==h[0]||""==h[1])return c.warn("Lat or Long are empty string"),!1;a=parseFloat(h[0]);h=parseFloat(h[1]);h=new google.maps.LatLng(a,h)}A(h,b,d,f,g,j,i)}function w(){clearTimeout(B);if(0<v.length){var b=v.shift();c.info("Passing ["+b.address+"] to Geo service. Have left "+v.length+" items to process!");b.address instanceof google.maps.LatLng?H(b):N.geocode({address:b.address},function(a,f){R(a,
f,b)})}else{O();if(0<C.length){var k="";a.each(C,function(a,b){k+="&nbsp;&nbsp;&nbsp;<b>"+(1+a)+". "+b+"</b><br />"});y.alertError(CGMPGlobal.errors.badAddresses.replace("[REPLACE]",k))}C=[]}}function O(){1<s.length?(a.each(s,function(a,b){D.contains(b.position)||D.extend(b.position)}),t=D,m.fitBounds(D),q=m.getZoom()):1==s.length&&(m.setCenter(s[0].position),q=m.getZoom())}function H(a){var b=a.address;1==a.zIndex&&(z=b);var d=b.lat(),d=parseFloat(d),d=d.toFixed(5),f=b.lng(),f=parseFloat(f),f=f.toFixed(5);
a.address="Lat/Long: "+d+", "+f;P(b,a);w()}function R(a,b,d){b==google.maps.GeocoderStatus.OK?(P(a[0].geometry.location,d),B=setTimeout(function(){w()},330)):b==google.maps.GeocoderStatus.OVER_QUERY_LIMIT?(O(),v.push(d),B=setTimeout(function(){w()},3E3)):b==google.maps.GeocoderStatus.ZERO_RESULTS&&(c.warn("Got ZERO results for ["+d.address+"]. Have left "+s.length+" items to process"),C.push(d.address),B=setTimeout(function(){w()},400))}function P(b,c){var d=new google.maps.Marker({position:b,title:c.address.replace("<br />",
" :: "),content:c.address,zIndex:c.zIndex+1E3,map:m});if(d){if(c.markerIcon){var f=c.markerIcon;d.setIcon(CGMPGlobal.customMarkersUri+f);var g=null,g=["4-default.png","5-default.png","6-default.png","7-default.png"],g=-1!=a.inArray(f,["1-default.png","2-default.png"])?E("http://maps.google.com/mapfiles/ms/icons/msmarker.shadow.png",59,32,0,0,16,33):-1!=a.inArray(f,g)?E("http://maps.google.com/mapfiles/ms/icons/msmarker.shadow.png",59,32,0,0,21,34):-1!=f.indexOf("3-default")?E("http://code.google.com/apis/maps/documentation/javascript/examples/images/beachflag_shadow.png",
37,32,0,0,10,33):E(CGMPGlobal.customMarkersUri+"shadow.png",68,37,0,0,32,38);d.setShadow(g)}j(d,c);F||(p(),F=!0);s.push(d)}}function E(a,b,d,f,c,g,h){return new google.maps.MarkerImage(a,new google.maps.Size(b,d),new google.maps.Point(f,c),new google.maps.Point(g,h))}var s,v,C,G,B,F,m,x,I,t,z,q,o,N,D,r,J,u,K;return{init:function(a,b){m=a;o=m.getDiv().id;I=b;google.maps.event.addListener(m,"click",function(){g()});s=[];C=[];v=[];q=5;t=z=x=B=null;G=F=!1;N=new google.maps.Geocoder;D=new google.maps.LatLngBounds;
r=new google.maps.InfoWindow;J=new google.maps.StreetViewService;K=new google.maps.DirectionsService;rendererOptions={draggable:!0};u=new google.maps.DirectionsRenderer(rendererOptions);u.setPanel(document.getElementById("rendered-directions-placeholder-"+o))},buildAddressMarkers:function(b,g,d){G=!0;x=n.trim(b);x=n.searchReplace(x,"'","");if("true"==g)b=a.parseJSON(x),"true"==d?L(b,!0):"false"==d&&L(b,!1),w();else if("false"==g){d=x.split("|");c.info("Exploded CSV into locations: "+d);for(b=0;b<
d.length;b++){var f=d[b];null!=f&&""!=f&&(f=n.trim(f),""==f?c.warn("Given extra marker address is empty"):(g=b+1,f=f.split(CGMPGlobal.sep),n.isNumeric(f[0])?M(f[0],g,f[1],"","","",!1):n.isAlphaNumeric(f[0])?A(f[0],g,f[1],"","","",!1):(A(f[0],g,f[1],"","","",!1),c.warn("Unknown type of geo destination in regexp: "+f[0]+", fallingback to store it as an address"))))}w()}},isBuildAddressMarkersCalled:function(){return G}}},n=function(){return{isNumeric:function(a){return/^([0-9?(\-.,\s{1,})]+)$/.test(a)},
isAlphaNumeric:function(a){return/^([a-zA-Z0-9?(/\-.,\s{1,})]+)$/.test(a)},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},searchReplace:function(a,b,c){return a.replace(RegExp(b,"g"),c)}}}(),c=function(){var c=function(b){a.browser.msie||(a.browser.mozilla&&3<=parseInt(a.browser.version)?console.log(b):console.log("Logger could not print because browser is Mozilla ["+a.browser.mozilla+"] and its version is ["+parseInt(a.browser.version)+"]"))};return{info:function(a){c("Info :: "+a)},raw:function(a){c(a)},
warn:function(a){c("Warning :: "+a)},error:function(a){c("Error :: "+a)},fatal:function(a){c("Fatal :: "+a)}}}(),y=function(){return{alertError:function(c){var b=a('<div id="mask"/>'),j=Math.random().toString(36).substring(3),i=a('<div id="'+j+'" class="shortcode-dialog window" />');i.html("<p style='padding: 10px 10px 0 10px'>"+c+"</p><div align='center'><input type='button' class='close-dialog' value='Close' /></div>");a("body").append(b);a("body").append(i);c=a(document).height();b=a(window).width();
a("#mask").css({width:b,height:c,opacity:0.3});1==a("#mask").length&&a("#mask").show();c=a(window).height();b=a(window).width();a("div#"+j).css("top",c/2-a("div#"+j).height()/2);a("div#"+j).css("left",b/2-a("div#"+j).width()/2);a("div#"+j).fadeIn(500);a(".window .close-dialog").click(function(b){b.preventDefault();(b=a(this).closest("div.shortcode-dialog"))&&a(b).remove();0==a("div.shortcode-dialog").length&&a("#mask").remove()});a("#mask").click(function(){a(this).remove();a(".window").remove()});
a(window).resize(function(){var b=a(".window"),c=a(document).height(),g=a(window).width();a("#mask").css({width:g,height:c});c=a(window).height();g=a(window).width();b.css("top",c/2-b.height()/2);b.css("left",g/2-b.width()/2)})}}}();"undefined"!=typeof CGMPGlobal&&CGMPGlobal.maps?(c.info("The CGMPGlobal object has ["+CGMPGlobal.maps.length+"] map JSONs inside"),a.each(CGMPGlobal.maps,function(g,b){if("undefined"==typeof google||!google)return y.alertError(CGMPGlobal.errors.msgNoGoogle),c.fatal("We do not have reference to Google API. Aborting map generation .."),
!1;if("undefined"!=typeof GMap2&&GMap2)return y.alertError(CGMPGlobal.errors.msgApiV2),c.fatal("It looks like the webpage has reference to GMap2 object from Google API v2. Aborting map generation .."),!1;if(0<a("div#"+b.id).length){var j=new google.maps.Map(document.getElementById(b.id));i.initMap(j,b.bubbleautopan,parseInt(b.zoom),b.maptype);p.init(j);var n=new H;n.init(j,b.bubbleautopan);i.mapControl(b.maptypecontrol,i.ControlType.MAPTYPE);i.mapControl(b.pancontrol,i.ControlType.PAN);i.mapControl(b.zoomcontrol,
i.ControlType.ZOOM);i.mapControl(b.scalecontrol,i.ControlType.SCALE);i.mapControl(b.scrollwheelcontrol,i.ControlType.SCROLLWHEEL);i.mapControl(b.streetviewcontrol,i.ControlType.STREETVIEW);"true"==b.showpanoramio&&p.buildPanoramioLayer(b.panoramiouid);"true"==b.showbike&&p.buildBikeLayer();"true"==b.showtraffic&&p.buildTrafficLayer();null!=b.kml&&""!=b.kml?p.buildKmlLayer(b.kml):(null!=b.markerlist&&""!=b.markerlist&&n.buildAddressMarkers(b.markerlist,b.addmarkermashup,b.geomashupbubble),n.isBuildAddressMarkersCalled()||
y.alertError(CGMPGlobal.errors.msgMissingMarkers))}else c.fatal("It looks like the map DIV placeholder ID ["+b.id+"] does not exist in the page!")})):c.fatal("The CGMPGlobal object is undefined. Aborting map generation .. d[-_-]b")})(jQueryCgmp);
